# Nebuly Platform (AWS)

Terraform module for provisioning Nebuly Platform resources on AWS.

```hcl
module "nebuly-platform" {
    source = "github.com/nebuly-ai/terraform-aws-nebuly-platform"
    ref    = "v0.2.7"
    # insert required variables here
}
```

## Providers

| Name                                                      | Version |
| --------------------------------------------------------- | ------- |
| <a name="provider_aws"></a> [aws](#provider_aws)          | 5.51.1  |
| <a name="provider_random"></a> [random](#provider_random) | 3.6.2   |
| <a name="provider_tls"></a> [tls](#provider_tls)          | 4.0.5   |

## Outputs

| Name                                                                                                                                | Description                                                                               |
| ----------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------- |
| <a name="output_admin_user_password"></a> [admin_user_password](#output_admin_user_password)                                        | The password of the initial admin user of the platform.                                   |
| <a name="output_admin_user_password_secret_name"></a> [admin_user_password_secret_name](#output_admin_user_password_secret_name)    | The name of the secret containing the password of the initial admin user of the platform. |
| <a name="output_analytics_db"></a> [analytics_db](#output_analytics_db)                                                             | Details of the analytics DB hosted on an RDS instance.                                    |
| <a name="output_analytics_db_credentials"></a> [analytics_db_credentials](#output_analytics_db_credentials)                         | Credentials for connecting with the analytics DB.                                         |
| <a name="output_auth_db"></a> [auth_db](#output_auth_db)                                                                            | Details of the auth DB hosted on an RDS instance.                                         |
| <a name="output_auth_db_credentials"></a> [auth_db_credentials](#output_auth_db_credentials)                                        | Credentials for connecting with the auth DB.                                              |
| <a name="output_auth_jwt_key_secret_name"></a> [auth_jwt_key_secret_name](#output_auth_jwt_key_secret_name)                         | The name of the secret containing the SSL Key used for generating JWTs.                   |
| <a name="output_eks_cluster_endpoint"></a> [eks_cluster_endpoint](#output_eks_cluster_endpoint)                                     | Endpoint for EKS control plane.                                                           |
| <a name="output_eks_cluster_get_credentials"></a> [eks_cluster_get_credentials](#output_eks_cluster_get_credentials)                | Command for getting the credentials for accessing the Kubernetes Cluster.                 |
| <a name="output_eks_cluster_name"></a> [eks_cluster_name](#output_eks_cluster_name)                                                 | Kubernetes Cluster Name.                                                                  |
| <a name="output_eks_cluster_security_group_id"></a> [eks_cluster_security_group_id](#output_eks_cluster_security_group_id)          | Security group ids attached to the cluster control plane.                                 |
| <a name="output_eks_iam_role_arn"></a> [eks_iam_role_arn](#output_eks_iam_role_arn)                                                 | The ARN of the EKS IAM role.                                                              |
| <a name="output_eks_load_balancer_security_group"></a> [eks_load_balancer_security_group](#output_eks_load_balancer_security_group) | The security group linked with the EKS load balancer.                                     |
| <a name="output_eks_service_accounts"></a> [eks_service_accounts](#output_eks_service_accounts)                                     | The service accounts that will able to assume the EKS IAM Role.                           |
| <a name="output_openai_api_key_secret_name"></a> [openai_api_key_secret_name](#output_openai_api_key_secret_name)                   | The name of the secret storing the OpenAI API Key.                                        |
| <a name="output_s3_bucket_ai_models"></a> [s3_bucket_ai_models](#output_s3_bucket_ai_models)                                        | The details of the bucket used as model registry for storing the AI Models                |

## Inputs

| Name                                                                                                                                                                  | Description                                                                                                                                                                                                                                                                                          | Type                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | Default                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | Required |
| --------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :------: |
| <a name="input_allowed_inbound_cidr_blocks"></a> [allowed_inbound_cidr_blocks](#input_allowed_inbound_cidr_blocks)                                                    | The CIDR blocks from which inbound connections will be accepted. Use 0.0.0.0/0 for allowing all inbound traffic                                                                                                                                                                                      | `map(string)`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | n/a                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |   yes    |
| <a name="input_eks_cloudwatch_observability_enabled"></a> [eks_cloudwatch_observability_enabled](#input_eks_cloudwatch_observability_enabled)                         | If true, install the CloudWatch Observability add-on.<br> The add-on installs the CloudWatch agent to send infrastructure metrics from the cluster, <br> installs Fluent Bit to send container logs, and also enables CloudWatch Application Signals <br> to send application performance telemetry. | `bool`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | `false`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |    no    |
| <a name="input_eks_cluster_admin_arns"></a> [eks_cluster_admin_arns](#input_eks_cluster_admin_arns)                                                                   | List of ARNs that will be granted the role of Cluster Admin over EKS                                                                                                                                                                                                                                 | `set(string)`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | `[]`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |    no    |
| <a name="input_eks_cluster_endpoint_public_access"></a> [eks_cluster_endpoint_public_access](#input_eks_cluster_endpoint_public_access)                               | Indicates whether or not the Amazon EKS public API server endpoint is enabled.                                                                                                                                                                                                                       | `bool`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | n/a                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |   yes    |
| <a name="input_eks_enable_cluster_creator_admin_permissions"></a> [eks_enable_cluster_creator_admin_permissions](#input_eks_enable_cluster_creator_admin_permissions) | Indicates whether or not to add the cluster creator (the identity used by Terraform) as an administrator via access entry.                                                                                                                                                                           | `bool`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | `true`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |    no    |
| <a name="input_eks_kubernetes_version"></a> [eks_kubernetes_version](#input_eks_kubernetes_version)                                                                   | Specify which Kubernetes release to use.                                                                                                                                                                                                                                                             | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | n/a                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |   yes    |
| <a name="input_eks_managed_node_group_defaults"></a> [eks_managed_node_group_defaults](#input_eks_managed_node_group_defaults)                                        | The default settings of the EKS managed node groups.                                                                                                                                                                                                                                                 | <pre>object({<br> ami_type = string<br> })</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | <pre>{<br> "ami_type": "AL2_x86_64"<br>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |    no    |
| <a name="input_eks_managed_node_groups"></a> [eks_managed_node_groups](#input_eks_managed_node_groups)                                                                | The managed node groups of the EKS cluster.                                                                                                                                                                                                                                                          | <pre>map(object({<br> instance_types = set(string)<br> min_size = number<br> max_size = number<br> desired_size = optional(number)<br> subnet_ids = optional(list(string), null)<br> ami_type = optional(string, "AL2_x86_64")<br> disk_size_gb = optional(number, 128)<br> tags = optional(map(string), {})<br> use_custom_launch_template = optional(bool, false)<br> labels = optional(map(string), {})<br> taints = optional(set(object({<br> key : string<br> value : string<br> effect : string<br> })), [])<br> }))</pre> | <pre>{<br> "gpu-a100": {<br> "ami_type": "AL2_x86_64_GPU",<br> "desired_size": 0,<br> "disk_size_gb": 128,<br> "instance_types": [<br> "p4d.24xlarge"<br> ],<br> "labels": {<br> "nebuly.com/accelerator": "nvidia-ampere-a100",<br> "nvidia.com/gpu.present": "true"<br> },<br> "max_size": 1,<br> "min_size": 0,<br> "tags": {<br> "k8s.io/cluster-autoscaler/enabled": "true"<br> },<br> "taints": [<br> {<br> "effect": "NO_SCHEDULE",<br> "key": "nvidia.com/gpu",<br> "value": ""<br> }<br> ]<br> },<br> "gpu-t4": {<br> "ami_type": "AL2_x86_64_GPU",<br> "desired_size": 1,<br> "disk_size_gb": 128,<br> "instance_types": [<br> "g4dn.xlarge"<br> ],<br> "labels": {<br> "nebuly.com/accelerator": "nvidia-tesla-t4",<br> "nvidia.com/gpu.present": "true"<br> },<br> "max_size": 1,<br> "min_size": 1,<br> "taints": [<br> {<br> "effect": "NO_SCHEDULE",<br> "key": "nvidia.com/gpu",<br> "value": ""<br> }<br> ]<br> },<br> "workers": {<br> "desired_size": 1,<br> "instance_types": [<br> "r5.xlarge"<br> ],<br> "max_size": 1,<br> "min_size": 1<br> }<br>}</pre> |    no    |
| <a name="input_eks_service_accounts"></a> [eks_service_accounts](#input_eks_service_accounts)                                                                         | The service accounts that will able to assume the EKS IAM Role.                                                                                                                                                                                                                                      | <pre>list(object({<br> name : string<br> namespace : string<br> }))</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                        | <pre>[<br> {<br> "name": "aws-load-balancer-controller",<br> "namespace": "kube-system"<br> },<br> {<br> "name": "cluster-autoscaler",<br> "namespace": "kube-system"<br> },<br> {<br> "name": "nebuly",<br> "namespace": "nebuly"<br> },<br> {<br> "name": "nebuly",<br> "namespace": "default"<br> }<br>]</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |    no    |
| <a name="input_openai_api_key"></a> [openai_api_key](#input_openai_api_key)                                                                                           | The API Key used for authenticating with OpenAI.                                                                                                                                                                                                                                                     | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | n/a                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |   yes    |
| <a name="input_rds_analytics_instance_type"></a> [rds_analytics_instance_type](#input_rds_analytics_instance_type)                                                    | The instance type of the RDS instance hosting the analytics DB.                                                                                                                                                                                                                                      | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | `"db.m7g.xlarge"`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |    no    |
| <a name="input_rds_analytics_storage"></a> [rds_analytics_storage](#input_rds_analytics_storage)                                                                      | Storage settings of the analytics DB.                                                                                                                                                                                                                                                                | <pre>object({<br> allocated_gb : number<br> max_allocated_gb : number<br> type : string<br> iops : optional(number, null)<br> })</pre>                                                                                                                                                                                                                                                                                                                                                                                           | <pre>{<br> "allocated_gb": 32,<br> "max_allocated_gb": 128,<br> "type": "gp3"<br>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |    no    |
| <a name="input_rds_auth_instance_type"></a> [rds_auth_instance_type](#input_rds_auth_instance_type)                                                                   | The instance type of the RDS instance hosting the auth DB.                                                                                                                                                                                                                                           | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | `"t4g.small"`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |    no    |
| <a name="input_rds_auth_storage"></a> [rds_auth_storage](#input_rds_auth_storage)                                                                                     | Storage settings of the auth DB.                                                                                                                                                                                                                                                                     | <pre>object({<br> allocated_gb : number<br> max_allocated_gb : number<br> type : string<br> iops : optional(number, null)<br> })</pre>                                                                                                                                                                                                                                                                                                                                                                                           | <pre>{<br> "allocated_gb": 20,<br> "max_allocated_gb": 32,<br> "type": "gp2"<br>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |    no    |
| <a name="input_rds_availability_zone"></a> [rds_availability_zone](#input_rds_availability_zone)                                                                      | The availabilty zone of the RDS instances.                                                                                                                                                                                                                                                           | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | `null`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |    no    |
| <a name="input_rds_backup_retention_period"></a> [rds_backup_retention_period](#input_rds_backup_retention_period)                                                    | The retention period, in days, of the daily backups.                                                                                                                                                                                                                                                 | `number`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | `14`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |    no    |
| <a name="input_rds_backup_window"></a> [rds_backup_window](#input_rds_backup_window)                                                                                  | Description: The daily time range (in UTC) during which automated backups are created if they are enabled. Example: '09:46-10:16'. Must not overlap with maintenance_window.                                                                                                                         | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | `"03:00-06:00"`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |    no    |
| <a name="input_rds_db_username"></a> [rds_db_username](#input_rds_db_username)                                                                                        | The username to connect with the Postgres RDS databases.                                                                                                                                                                                                                                             | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | `"nebulyadmin"`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |    no    |
| <a name="input_rds_maintenance_window"></a> [rds_maintenance_window](#input_rds_maintenance_window)                                                                   | The window to perform maintenance in. Syntax: 'ddd:hh24:mi-ddd:hh24:mi'. Eg: 'Mon:00:00-Mon:03:00'.                                                                                                                                                                                                  | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | `"Mon:00:00-Mon:03:00"`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |    no    |
| <a name="input_rds_multi_availability_zone_enabled"></a> [rds_multi_availability_zone_enabled](#input_rds_multi_availability_zone_enabled)                            | If True, provision the RDS instances on multiple availability zones.                                                                                                                                                                                                                                 | `bool`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | `true`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |    no    |
| <a name="input_rds_postgres_family"></a> [rds_postgres_family](#input_rds_postgres_family)                                                                            | The PostgreSQL family to use for the RDS instances.                                                                                                                                                                                                                                                  | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | `"postgres16"`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |    no    |
| <a name="input_rds_postgres_version"></a> [rds_postgres_version](#input_rds_postgres_version)                                                                         | The PostgreSQL version to use for the RDS instances.                                                                                                                                                                                                                                                 | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | `"16"`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |    no    |
| <a name="input_region"></a> [region](#input_region)                                                                                                                   | The region where to provision the resources.                                                                                                                                                                                                                                                         | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | n/a                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |   yes    |
| <a name="input_resource_prefix"></a> [resource_prefix](#input_resource_prefix)                                                                                        | The prefix that will be used for generating resource names.                                                                                                                                                                                                                                          | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | n/a                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |   yes    |
| <a name="input_security_group"></a> [security_group](#input_security_group)                                                                                           | The security group to use.                                                                                                                                                                                                                                                                           | <pre>object({<br> name = string<br> id = string<br> })</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | n/a                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |   yes    |
| <a name="input_subnet_ids"></a> [subnet_ids](#input_subnet_ids)                                                                                                       | The IDs of the subnets to attach to the Platform resources.                                                                                                                                                                                                                                          | `set(string)`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | n/a                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |   yes    |
| <a name="input_tags"></a> [tags](#input_tags)                                                                                                                         | Common tags that will be applied to all resources.                                                                                                                                                                                                                                                   | `map(string)`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | `{}`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |    no    |
| <a name="input_vpc_id"></a> [vpc_id](#input_vpc_id)                                                                                                                   | The ID of the VPC to use.                                                                                                                                                                                                                                                                            | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | n/a                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |   yes    |

## Resources

- resource.aws_iam_role_policy_attachment.ai_models\_\_eks_reader (/terraform-docs/main.tf#425)
- resource.aws_s3_bucket.ai_models (/terraform-docs/main.tf#421)
- resource.aws_secretsmanager_secret.admin_user_password (/terraform-docs/main.tf#361)
- resource.aws_secretsmanager_secret.auth_jwt_key (/terraform-docs/main.tf#348)
- resource.aws_secretsmanager_secret.openai_api_key (/terraform-docs/main.tf#411)
- resource.aws_secretsmanager_secret.rds_analytics_credentials (/terraform-docs/main.tf#132)
- resource.aws_secretsmanager_secret.rds_auth_credentials (/terraform-docs/main.tf#215)
- resource.aws_secretsmanager_secret_version.admin_user_password (/terraform-docs/main.tf#365)
- resource.aws_secretsmanager_secret_version.auth_jwt_key (/terraform-docs/main.tf#352)
- resource.aws_secretsmanager_secret_version.openai_api_key (/terraform-docs/main.tf#414)
- resource.aws_secretsmanager_secret_version.rds_analytics_password (/terraform-docs/main.tf#135)
- resource.aws_secretsmanager_secret_version.rds_auth_password (/terraform-docs/main.tf#218)
- resource.aws_security_group.eks_load_balancer (/terraform-docs/main.tf#372)
- resource.aws_vpc_security_group_ingress_rule.eks_load_balancer_allow_http (/terraform-docs/main.tf#399)
- resource.aws_vpc_security_group_ingress_rule.eks_load_balancer_allow_https (/terraform-docs/main.tf#390)
- resource.random_password.admin_user_password (/terraform-docs/main.tf#357)
- resource.random_password.rds_analytics (/terraform-docs/main.tf#127)
- resource.random_password.rds_auth (/terraform-docs/main.tf#210)
- resource.random_string.secrets_suffix (/terraform-docs/main.tf#52)
- resource.tls_private_key.auth_jwt (/terraform-docs/main.tf#344)
- data source.aws_caller_identity.current (/terraform-docs/main.tf#20)
- data source.aws_partition.current (/terraform-docs/main.tf#21)
